<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namesapce속성은 이 매퍼가 어떤 인터페이스와 관련된 매퍼인지 알려준다. -->
<mapper namespace="com.mrmr.gamto.report.dao.IBook_reportDAO">
	<!-- 자유게시판 리스트 (삭제 번호가 0인 목록)-->
	<!-- 페이징 처리 후 게시글 조회 -->
	<select id="getPageList"  parameterType="Map" resultType="com.mrmr.gamto.report.dto.Book_reportDTO">
    select * from (
        	select 	rownum rn, book_report.*
        		from(
        			select* from book_report order by r_seq_number DESC) book_report)
        	WHERE RN BETWEEN #{startNo} AND #{endNo} and r_delete = '0'		
	</select>
	<!-- 총 게시글 갯수 출력 -->
	<select id="countBoard" resultType="int">
		select count(*) from book_report where r_delete = '0'
	</select>
	<!-- 선택된 게시판의 상세 정보가 보여지는 페이지 -->
	<select id="viewDao" resultType="com.mrmr.gamto.report.dto.Book_reportDTO">
		select * from book_report where r_seq_number=#{0}
	</select>
	<!-- 게시판 작성 -->
	<insert id="writeDao">
		insert into book_report values(book_report_seq.nextval,#{item1},#{item2},sysdate,sysdate,0,0,0,#{item3},#{item4})
	</insert>
	<!-- 게시판 수정 -->
	<update id="updateDao">
		update book_report set r_title = #{item1}, r_content = #{item2}, f_category = #{item3}, r_update_day = sysdate, r_view = r_view-1 where r_seq_number = #{item4}
	</update>
	<!-- 조회수를 카운트하는 update문 -->
	<update id="updateCnt">
		update book_report set r_view = r_view+1 where r_seq_number = #{item1}
	</update>
	<!-- 게시판 좋아요 수가 올라가는 update문 -->
	<update id="goodCnt">
		update  book_report set r_recommend = r_recommend+1, r_view = r_view-1 where r_seq_number = #{item1}
	</update>
	<!-- 삭제를 원하면 삭제 번호가 1로 변경되면서 목록에서는 보이지 않음 -->
	<update id="deleteDao">
		update book_report set r_delete ='1' where r_seq_number = #{item1}
	</update>
	
	<!-- 페이징 처리 후 카테고리 검색 게시글 조회 -->
	<select id="SearchCategory"  parameterType="Map" resultType="com.mrmr.gamto.report.dto.Book_reportDTO">
   select * from (
        	select 	rownum rn, free_board.*
        		from(
        			select* from book_report where r_delete = '0' order by r_seq_number DESC) book_report)
        	WHERE RN BETWEEN #{startNo} AND #{endNo} and r_category = #{category}
	</select>
	
	<!-- 페이징 처리 후 주제별 검색 게시글 조회 -->
	<select id="SearchTotal"  parameterType="Map" resultType="com.mrmr.gamto.report.dto.Book_reportDTO">
  	select * from 
   		(select rownum as rn, f.* 
   			from(
   				select * from book_report where r_delete = 0 AND
   				
   					<if test="item == 'f_title'">r_title like '%'||#{text}||'%'</if> 
   					<if test="item == 'f_content'">r_content like '%'||#{text}||'%'</if> 
   					<if test="item == 'f_writer'">r_writer like '%'||#{text}||'%'</if> 
   				
   					 order by r_seq_number desc) f) where rn BETWEEN #{startNo} AND #{endNo}	
	</select>
</mapper>