<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace속성은 이 매퍼가 어떤 인터페이스와 관련된 매퍼인지를 알려준다. -->
<mapper namespace="com.mrmr.gamto.store.dao.StoreDAO">
	<!-- id속성은 인터페이스의 메소드를 가져온다. resultType의 속성값은 리턴되는 값의 타입을 지정한다. -->

	<select id="listDao"
		resultType="com.mrmr.gamto.store.dto.StoreDTO">
		select * from book_info
	</select>

	<select id="viewDao"
		resultType="com.mrmr.gamto.store.dto.StoreDTO">
		select * from book_info where b_code = #{param1}
	</select>

	<delete id="deleteDao">
		delete book_info where b_code = #{param1}
	</delete>

	<!-- 장바구니 -->
	<select id="cartDao" resultType="com.mrmr.gamto.store.dto.CartDTO">
	select cart.cart_code as cart_code, book_info.b_name as cart_name, book_info.b_filename as cart_filename, book_info.b_price as cart_price, book_info.b_author as cart_author, cart.cart_quantity as cart_quantity FROM cart join book_info on cart.cart_code = book_info.b_code where cart.cart_id = 'qwer1234'
	</select>

	<update id="addCartDao">
		MERGE INTO cart USING (SELECT b_code, b_name,
		b_filename, b_price FROM book_info WHERE b_code = #{b_code}) bi ON
		(cart.cart_code = bi.b_code)
		WHEN MATCHED THEN
		UPDATE SET
		cart.cart_quantity = cart.cart_quantity+1
		WHEN NOT MATCHED THEN
		INSERT
		(cart.cart_seq_number, cart.cart_id, cart.cart_code,
		cart.cart_quantity)
		VALUES (#{cart_seq}, #{cart_id}, #{cart_code},
		#{cart_quantity})
	</update>

	<update id="removeCartDao">
		update book_info set b_quantity=0 where
		b_code=#{b_code}
	</update>

	<update id="removeAllCartDao">
		update book_info set b_quantity=0
	</update>
	
	<select id="listNumDao" resultType="int">
	   select count(cart_code) from cart where cart_quantity>0 and cart_id = ${param1}
	</select>
</mapper>